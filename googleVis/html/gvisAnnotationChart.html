<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Google Annotation Chart with R</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for gvisAnnotationChart {googleVis}"><tr><td>gvisAnnotationChart {googleVis}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Google Annotation Chart with R

</h2>

<h3>Description</h3>

<p>gvisAnnotationChart charts are interactive time series line charts that support 
annotations. Unlike the gvisAnnotatedTimeLine, which uses Flash, 
annotation charts are SVG/VML and should be preferred whenever possible.
</p>


<h3>Usage</h3>

<pre>
gvisAnnotationChart(data, datevar = "", numvar = "", idvar = "",
  titlevar = "", annotationvar = "", date.format = "%Y/%m/%d",
  options = list(), chartid)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>data</code></td>
<td>
<p>a <code>data.frame</code>. The data has to have at least two columns,
one with date information (<code>datevar</code>) and one numerical variable.</p>
</td></tr>
<tr valign="top"><td><code>datevar</code></td>
<td>
<p>column name of <code>data</code> which shows the date dimension.
The information has to be of class <code><a href="../../base/html/Dates.html">Date</a></code> or <code>POSIX*</code> time
series.</p>
</td></tr>
<tr valign="top"><td><code>numvar</code></td>
<td>
<p>column name of <code>data</code> which shows the values to be
displayed against <code>datevar</code>. The information has to be
<code><a href="../../base/html/numeric.html">numeric</a></code>.</p>
</td></tr>
<tr valign="top"><td><code>idvar</code></td>
<td>
<p>column name of <code>data</code> which identifies different groups of
the data. The information has to be of class <code><a href="../../base/html/character.html">character</a></code> or
<code><a href="../../base/html/factor.html">factor</a></code>.</p>
</td></tr>
<tr valign="top"><td><code>titlevar</code></td>
<td>
<p>column name of <code>data</code> which shows the title of the
annotations. The information has to be of class <code><a href="../../base/html/character.html">character</a></code> or
<code><a href="../../base/html/factor.html">factor</a></code>.  Missing information can be set to <code>NA</code>. See
section 'Details' for more details.</p>
</td></tr>
<tr valign="top"><td><code>annotationvar</code></td>
<td>
<p>column name of <code>data</code> which shows the annotation
text. The information has to be of class <code><a href="../../base/html/character.html">character</a></code> or
<code><a href="../../base/html/factor.html">factor</a></code>. Missing information can be set to <code>NA</code>. See
section 'Details' for more details.</p>
</td></tr>
<tr valign="top"><td><code>date.format</code></td>
<td>
<p>if <code>datevar</code> is of class <code><a href="../../base/html/Dates.html">Date</a></code> then
this argument specifies how the dates are reformatted to be used by
JavaScript.</p>
</td></tr>
<tr valign="top"><td><code>options</code></td>
<td>
<p>list of configuration options, see:
</p>

<p><a href="https://google-developers.appspot.com/chart/interactive/docs/gallery/annotationchart#Configuration_Options">https://google-developers.appspot.com/chart/interactive/docs/gallery/annotationchart#Configuration_Options</a></p>

<p>The parameters can be set via a named list. The parameters have to map those
of the Google documentation. 
</p>

<ul>
<li><p>Boolean arguments are set to 
either <code>TRUE</code> or <code>FALSE</code>, using the R syntax.

</p>
</li>
<li><p>Google API parameters with a single value and with names that don't 
include a &quot;.&quot; are set like one would do in R, that is 
<code>options=list(width=200, height=300)</code>. 
Exceptions to this rule are the width and height options for 
<code><a href="gvisAnnotatedTimeLine.html">gvisAnnotatedTimeLine</a></code> and <code><a href="gvisAnnotationChart.html">gvisAnnotationChart</a></code>.
For those two functions, width and height must be character strings of the 
format <code>"Xpx"</code>, where <code>X</code> is a number, or <code>"automatic"</code>. 
For example, 
<code>options=list(width="200px", height="300px")</code>.

</p>
</li>
<li><p>Google API parameters with names that don't include a &quot;.&quot;, but require 
multivalues are set as a character, wrapped in &quot;[ ]&quot; and separated by commas, 
e.g. 

<code>options=list(colors="['#cbb69d', '#603913', '#c69c6e']")</code>

</p>
</li>
<li><p>Google API parameters with names that do include a &quot;.&quot; present parameters with 
several sub-options and have to be set as a character wrapped in &quot; &quot;.
The values of those sub-options are set via parameter:value. Boolean values
have to be stated as <code>'true'</code> or <code>'false'</code>. 
For example the Google documentaion states the formating options for the 
vertical axis and states the parameter as <code>vAxis.format</code>. 
Then this paramter can be set in R as:

<code>options=list(vAxis="{format:'#,###%'}")</code>. 

</p>
</li>
<li><p>If several sub-options have to be set, e.g. 

<code>titleTextStyle.color</code>, <code>titleTextStyle.fontName</code> and 
<code>titleTextStyle.fontSize</code>, then those can be combined in one list item 
such as:

<code>options=list(titleTextStyle="{color:'red', fontName:'Courier', fontSize:16}")</code>

</p>
</li>
<li><p>paramters that can have more than one value per sub-options are 
wrapped in &quot;[ ]&quot;. For example to set the labels for left and right axes use:

<code>options=list(vAxes="[{title:'val1'}, {title:'val2'}]")</code>

</p>
</li>
<li><p><code>gvis.editor</code> a character label for an
 on-page button that opens an in-page dialog box enabling
users to edit, change and customise the chart. By default no
value is given and therefore no button is displayed. 

</p>
</li></ul>

<p>For more details see the Google API documentation and the R examples below.   </p>
</td></tr>
<tr valign="top"><td><code>chartid</code></td>
<td>
<p>character. If missing (default) a random chart id will be 
generated based on chart type and <code><a href="../../base/html/tempfile.html">tempfile</a></code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>gvisAnnotationChart returns list 
of <code><a href="../../base/html/class.html">class</a></code>
&quot;<code>gvis</code>&quot; and &quot;<code>list</code>&quot;.   
An object of class &quot;<code>gvis</code>&quot; is a list containing at least the
following components:
</p>

<dl>
<dt><code>type</code></dt><dd><p>Google visualisation type</p>
</dd>
<dt><code>chartid</code></dt><dd><p>character id of the chart object. Unique chart
ids are required to place several charts on the same page.
</p>
</dd>
<dt><code>html</code></dt><dd><p>a list with the building blocks for a page
</p>

<dl>
<dt><code>header</code></dt><dd><p>a character string of a html page header:
<code>&lt;html&gt;...&lt;body&gt;</code>,</p>
</dd>
<dt><code>chart</code></dt><dd><p>a named character vector of the chart's building blocks:
</p>

<dl>
<dt><code>jsHeader</code></dt><dd><p>Opening <code>&lt;script&gt;</code> tag and
reference to Google's JavaScript library.
</p>
</dd>
<dt><code>jsData</code></dt><dd><p>JavaScript function defining the input
<code>data</code> as a JSON object.
</p>
</dd> 
<dt><code>jsDrawChart</code></dt><dd><p>JavaScript function combing the data with 
the visualisation API and user options.
</p>
</dd>
<dt><code>jsDisplayChart</code></dt><dd><p>JavaScript function calling the
handler to display the chart.
</p>
</dd>
<dt><code>jsFooter</code></dt><dd><p>End tag <code>&lt;/script&gt;</code>.
</p>
</dd>
<dt><code>jsChart</code></dt><dd><p>Call of the <code>jsDisplayChart</code> function.
</p>
</dd>
<dt><code>divChart</code></dt><dd><p><code>&lt;div&gt;</code> container to embed the chart
into the page.
</p>
</dd>
</dl>
   
</dd>
<dt><code>caption</code></dt><dd><p>character string of a standard caption,
including data name and chart id.
</p>
</dd>  
<dt><code>footer</code></dt><dd><p>character string of a html page footer:
<code>&lt;/body&gt;...&lt;/html&gt;</code>, including the used R and googleVis version
and link to Google's Terms of Use.</p>
</dd>
</dl>
</dd>
</dl>



<h3>Author(s)</h3>

<p>Markus Gesmann <a href="mailto:markus.gesmann@gmail.com">markus.gesmann@gmail.com</a>,
Diego de Castillo <a href="mailto:decastillo@gmail.com">decastillo@gmail.com</a>
</p>


<h3>References</h3>

<p>Google Chart Tools API: 
<a href="https://google-developers.appspot.com/chart/interactive/docs/gallery/annotationchart">https://google-developers.appspot.com/chart/interactive/docs/gallery/annotationchart</a></p>




<h3>See Also</h3>

<p>See also <code><a href="gvisMethods.html">print.gvis</a></code>, <code><a href="gvisMethods.html">plot.gvis</a></code> for printing and
plotting methods. Further see <code><a href="../../stats/html/reshape.html">reshape</a></code> for reshaping data, e.g.
from a wide format into a long format.
</p>


<h3>Examples</h3>

<pre>

## Please note that by default the googleVis plot command
## will open a browser window and requires Internet
## connection to display the visualisation.


data(Stock)
Stock
A1 &lt;- gvisAnnotationChart(Stock, datevar="Date",
                           numvar="Value", idvar="Device",
                           titlevar="Title", annotationvar="Annotation",
                           options=list(displayAnnotations=TRUE,
                            legendPosition='newRow',
                            width=600, height=350)
                           )
plot(A1)

## Two Y-axis
A2 &lt;- gvisAnnotationChart(Stock, datevar="Date",
                           numvar="Value", idvar="Device",
                           titlevar="Title", annotationvar="Annotation",
                           options=list(displayAnnotations=TRUE, 
                            width=600, height=350, scaleColumns='[0,1]',
                            scaleType='allmaximized')
                          )
plot(A2)

## Zoom into the time window, no Y-axis ticks
A3 &lt;- gvisAnnotationChart(Stock, datevar="Date",
                           numvar="Value", idvar="Device",
                           titlevar="Title", annotationvar="Annotation",
                           options=list(
                             width=600, height=350,
                            zoomStartTime=as.Date("2008-01-04"),
                            zoomEndTime=as.Date("2008-01-05")) 
                          )
plot(A3)



## Colouring the area below the lines to create an area chart
A4 &lt;- gvisAnnotationChart(Stock, datevar="Date",
                           numvar="Value", idvar="Device",
                           titlevar="Title", annotationvar="Annotation",
                           options=list(
                             width=600, height=350,
                             fill=10, displayExactValues=TRUE,
                             colors="['#0000ff','#00ff00']")
                           )
                          
plot(A4)


## Data with POSIXct datetime variable
A5 &lt;- gvisAnnotationChart(Andrew, datevar="Date/Time UTC",
                            numvar="Pressure_mb",
                            options=list(scaleType='maximized')
                            )

plot(A5)


## Not run: 

## Plot Apple's monthly stock prices since 1984

## Get current date
d &lt;- Sys.time() 
current.year &lt;- format(d, "%Y")
current.month &lt;- format(d, "%m")
current.day &lt;- format(d, "%d")

## Yahoo finance sets January to 00 hence: 
month &lt;- as.numeric(current.month)  - 1
month &lt;- ifelse(month &lt; 10, paste("0",month, sep=""), m)

## Get weekly stock prices from Apple Inc.
tckr &lt;- 'AAPL'
yahoo &lt;- 'https://ichart.finance.yahoo.com/table.csv'

fn &lt;- sprintf('%s?s=%s&amp;a=08&amp;b=7&amp;c=1984&amp;d=%s&amp;e=%s&amp;f=%s&amp;g=w&amp;ignore=.csv',
      yahoo, tckr, month, current.day, current.year)

## Get data from Yahoo! Finance
data &lt;- read.csv(fn, colClasses=c("Date", rep("numeric",6)))

AAPL &lt;- reshape(data[,c("Date", "Close", "Volume")], idvar="Date", 
     		times=c("Close", "Volume"), 
                timevar="Type",
                varying=list(c("Close", "Volume")),
                v.names="Value",
                direction="long")

## Calculate previous two years for zoom start time
lyd &lt;- as.POSIXlt(as.Date(d))
lyd$year &lt;- lyd$year-2
lyd &lt;- as.Date(lyd)

aapl &lt;- gvisAnnotationChart(AAPL, datevar="Date",
                           numvar="Value", idvar="Type",
                          options=list(
                            colors="['blue', 'lightblue']",
                            zoomStartTime=lyd,
                            zoomEndTime=as.Date(d),
                            legendPosition='newRow',
                            width=600, height=400, scaleColumns='[0,1]',
                            scaleType='allmaximized')
                           )

plot(aapl)

## End(Not run)

</pre>

<hr /><div style="text-align: center;">[Package <em>googleVis</em> version 0.6.4 <a href="00Index.html">Index</a>]</div>
</body></html>
